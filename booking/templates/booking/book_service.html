{% load static %}
<!DOCTYPE html>
<html lang="pt-pt">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'booking/css/book_service.css' %}" />
    <link rel="stylesheet" href="{% static 'booking/css/header.css' %}" />
    <link rel="stylesheet" href="{% static 'booking/css/preco.css' %}" />
    <link rel="stylesheet" href="{% static 'booking/css/footer.css' %}">
    <title>Agendar Seriços</title>
    <script>
        document
            .getElementById("bookingForm")
            .addEventListener("submit", async function (e) {
                e.preventDefault();
                const form = e.currentTarget;
                const data = new FormData(form);
                const resp = await fetch(form.action, {
                    method: "POST",
                    body: data,
                    headers: { "X-Requested-With": "XMLHttpRequest" },
                });
                if (resp.ok) {
                    document.getElementById("notice").innerHTML =
                        '<p style="color:green">Agendamento confirmado.</p>';
                    form.reset();
                } else {
                    document.getElementById("notice").innerHTML =
                        '<p style="color:red">Erro ao agendar.</p>';
                }
            });
    </script>
</head>


<body>
    {% include 'components/header/header.html' %}

    <main>
        <div id="bookingApp">
            <h3>Preencha o formulário abaixo para agendar um serviço.</h3>
            <div id="formContainer">
                <form id="bookingForm" method="post" action="{% url 'book_service' %}">
                    {% csrf_token %} {{ form.as_p }}
                    <button id="btAngendar" type="submit">Agendar</button>
                </form>
            </div>
            <div id="notice"></div>
            <h2>Após agendamento, receberá confirmação por e-mail.</h2>

            <h1>
                <a href="{% url 'bookings_list' %}" class="btn"> Ver agendamentos </a>
            </h1>
        </div>
    </main>

    {% include 'components/preco/preco.html' %}

</body>

{% include 'components/footer/footer.html' %}

</html>